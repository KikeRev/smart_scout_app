{# templates/…/_message.html #}
{% load markdownify %}

<div class="msg {{ m.role }}">
  {% autoescape off %}
    {{ m.content|markdownify }}
  {% endautoescape %}

  {# ─── NUEVO: pinta adjuntos ──────────────────────────────── #}
  {% if m.meta %}
      {% for att in m.meta %}
          {% if att.type == "image" %}
              <figure class="my-3 text-center">
                  <img src="{{ att.url }}" alt="{{ att.alt }}" class="img-fluid rounded shadow-sm"/>
                  <figcaption class="mt-2">
                    <a href="{{ att.url }}" download class="btn btn-send btn-outline-secondary">
                      Descargar imagen
                    </a>
                  </figcaption>
              </figure>
          {% elif att.type == "table" %}
              {{ att.html|safe }}
          {% elif att.type == "file" %}
            <a href="{{ att.url }}" target="_blank" class="btn btn-send btn-outline-secondary my-2">
              📄 {{ att.title|default:"Descargar archivo" }}
            </a>
          {% endif %}
      {% endfor %}
  {% endif %}
  {% if m.role == "assistant" %}
    <span class="rating">
      👍 <input type="radio" name="rate_{{ m.id }}" value="up">
      👎 <input type="radio" name="rate_{{ m.id }}" value="down">
    </span>
  {% endif %}
</div>