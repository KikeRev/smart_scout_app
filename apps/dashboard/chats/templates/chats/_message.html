{% load markdownify %}

{% if m.role == "user" %}
<div class="chat-row chat-user">
  <div class="bubble bubble-user fade-in">
    {% autoescape off %}
      {{ m.content|markdownify }}
    {% endautoescape %}
  </div>
</div>
{% else %}
<div class="chat-row chat-bot">
  <div class="bubble bubble-bot fade-in">
    {% autoescape off %}
      {{ m.content|markdownify }}
    {% endautoescape %}

    {# â”€â”€â”€ Adjuntos (botÃ³n, imagen, tablaâ€¦) â”€â”€â”€ #}
    {% if m.meta %}
        {% for att in m.meta %}
            {% if att.type == "image" %}
                <figure class="my-3 text-center">
                    <img src="{{ att.url }}" alt="{{ att.alt }}" class="img-fluid rounded shadow-sm"/>
                    <figcaption class="mt-2">
                        <a href="{{ att.url }}" download class="btn btn-send btn-outline-secondary">
                            Descargar imagen
                        </a>
                    </figcaption>
                </figure>
            {% elif att.type == "table" %}
                {{ att.html|safe }}
            {% elif att.type == "file" %}
                <a href="{{ att.url }}" target="_blank" class="btn btn-send btn-outline-secondary my-2">
                    ğŸ“„ {{ att.title|default:"Descargar archivo" }}
                </a>
            {% endif %}
        {% endfor %}
    {% endif %}

    {# â”€â”€â”€ ValoraciÃ³n ğŸ‘ğŸ‘ solo para respuestas del bot â”€â”€â”€ #}
    <span class="rating">
        ğŸ‘ <input type="radio" name="rate_{{ m.id }}" value="up">
        ğŸ‘ <input type="radio" name="rate_{{ m.id }}" value="down">
    </span>
  </div>
</div>
{% endif %}
